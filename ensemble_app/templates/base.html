{% load static %}
{% load role_permissions %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Ensemble App{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'styles2.css' %}">
  <style>
    html, body {
      font-size: 16px;
      width: 100vw;
      min-width: 0;
      max-width: 100vw;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    body {
      background: linear-gradient(135deg, #f0f4f8 0%, #e0f7fa 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .top-navbar {
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 8px rgba(67,233,123,0.07);
      padding: 0.5rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 1040;
      min-height: 56px;
    }
    .top-navbar .nav-pills {
      display: flex;
      gap: 18px;
      align-items: center;
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .top-navbar .nav-link {
      color: #020381;
      font-weight: 600;
      font-size: 1.07em;
      background: none;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      transition: background 0.18s, color 0.18s;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .top-navbar .nav-link.active,
    .top-navbar .nav-link:focus,
    .top-navbar .nav-link:hover {
      background: linear-gradient(90deg, #34C759 0%, #38f9d7 100%);
      color: #fff !important;
      outline: none;
    }
    .ensemble-glow {
      color: #020381;
      text-shadow: 0 0 8px #34C759, 0 0 16px #34C759, 0 0 24px #020381, 0 0 32px #34C759;
      font-size: 1.3em;
      font-weight: 800;
      letter-spacing: 0.04em;
    }
    /* Sidebar overlay for mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.25);
      z-index: 1039;
    }
    .sidebar-nav {
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      width: 280px;
      background: #fff;
      box-shadow: 2px 0 16px rgba(2,3,129,0.08);
      z-index: 1040;
      padding: 24px 0 24px 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: transform 0.3s;
      transform: translateX(0);
      overflow-y: auto;
    }
    .sidebar-nav.closed {
      transform: translateX(-110%);
    }
    .sidebar-nav .nav-link {
      display: flex;
      align-items: center;
      gap: 0.7em;
      padding: 10px 24px;
      color: #020381 !important;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.05em;
      letter-spacing: 0.01em;
      margin-bottom: 4px;
      border: 2px solid transparent;
      background: none;
      transition: background 0.18s, color 0.18s, border 0.18s;
      white-space: normal;
      word-break: break-word;
      overflow: hidden;
    }
    .sidebar-nav .nav-link.active,
    .sidebar-nav .nav-link:hover {
      background: #f0f4f8;
      color: #34C759 !important;
      border: 2px solid #34C759;
    }
    .sidebar-nav .nav-link i {
      min-width: 22px;
      flex-shrink: 0;
      opacity: 0.8;
    }
    .sidebar-nav .nav-link span {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      display: inline-block;
    }
    .sidebar-nav .sidebar-collapse-btn {
      background: none;
      border: none;
      color: #020381;
      font-size: 1em;
      font-weight: 700;
      padding: 8px 24px;
      width: 100%;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 0.6em;
      cursor: pointer;
      transition: color 0.2s;
      outline: none;
      margin-bottom: 2px;
    }
    .sidebar-nav .sidebar-collapse-btn:focus,
    .sidebar-nav .sidebar-collapse-btn:hover {
      color: #34C759;
    }
    .sidebar-nav .sidebar-collapse-icon {
      margin-left: auto;
      transition: transform 0.3s;
    }
    .sidebar-nav .fa-rotate-90 {
      transform: rotate(90deg);
    }
    .sidebar-nav .sidebar-collapse-list {
      padding-left: 0;
      margin: 0;
      display: none;
    }
    .sidebar-nav .sidebar-collapse-list.show {
      display: block;
    }
    .sidebar-nav .sidebar-category {
      font-size: 0.95em;
      font-weight: 700;
      color: #34C759;
      padding: 8px 24px 4px 24px;
      text-transform: uppercase;
      opacity: 0.85;
      margin-top: 10px;
      margin-bottom: 2px;
      user-select: none;
    }
    .sidebar-nav .mt-auto {
      margin-top: auto;
    }
    /* Hamburger */
    #sidebarHamburger {
      display: none;
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 1101;
      background: #fff;
      border: 2px solid #34C759;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 1.5em;
      color: #020381;
      box-shadow: 0 2px 8px rgba(67,233,123,0.12);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    @media (max-width: 991px) {
      #sidebarHamburger { display: block; }
      .sidebar-nav { transform: translateX(-110%); }
      .sidebar-nav.open { transform: translateX(0); }
      .sidebar-overlay { display: none; }
      .sidebar-overlay.active { display: block; }
    }
    @media (min-width: 992px) {
      .sidebar-nav { transform: translateX(0) !important; }
      .sidebar-overlay { display: none !important; }
      #sidebarHamburger { display: none !important; }
    }
    /* Content wrapper */
    .content-wrapper {
      margin-left: 220px;
      margin-top: 0;
      padding: 32px 2vw 32px 2vw;
      width: auto;
      min-width: 0;
      box-sizing: border-box;
      transition: margin-left 0.3s, width 0.3s;
      overflow-x: auto;
    }
    @media (max-width: 991px) {
      .content-wrapper {
        margin-left: 0;
        padding: 24px 2vw 24px 2vw;
        width: 100vw;
        min-width: 0;
        overflow-x: auto;
      }
    }
    @media (max-width: 600px) {
      .content-wrapper {
        padding: 14px 1vw 14px 1vw;
      }
    }
    .role-switcher {
      position: fixed;
      top: 70px;
      right: 20px;
      z-index: 1050;
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 10px 16px;
    }
    .role-switcher .btn {
      background: #2563eb !important;
      color: #fff !important;
      border: none !important;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(37,99,235,0.10);
    }
    .role-switcher .btn:hover, .role-switcher .btn:focus {
      background: #1d4ed8 !important;
      color: #fff !important;
    }
  </style>
  {% block extra_css %}{% endblock %}
</head>
<body>
  <!-- Hamburger for sidebar -->
  <button id="sidebarHamburger" aria-label="Toggle sidebar">
    <i class="fa fa-bars"></i>
  </button>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <!-- Top Navbar -->
  <header class="top-navbar">
    <nav aria-label="Top navigation">
      <ul class="nav-pills">
        <li>
          <a href="/" class="nav-logo nav-link" tabindex="0" aria-label="Home">
            <span class="ensemble-glow">Ensemble</span>
            <span class="sr-only">Home</span>
          </a>
        </li>
        {% has_role_permission 'role_permission_management' as can_role_perm %}
        {% if can_role_perm %}
        <li>
          <a href="{% url 'role_permission_management' %}" class="nav-link{% if request.resolver_match.url_name == 'role_permission_management' %} active{% endif %}">Role Permissions</a>
        </li>
        {% endif %}
      </ul>
    </nav>
  </header>
  <!-- Sidebar -->
  <nav class="sidebar-nav closed" id="sidebarNav">
    {% if current_role %}
      {% if current_role == "Learner" %}
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#learnerDashboardMenu" aria-expanded="true">
            <i class="fa fa-graduation-cap"></i> <span>Learner Dashboard</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right fa-rotate-90"></span>
          </button>
          <ul class="sidebar-collapse-list show" id="learnerDashboardMenu">
            {% has_role_permission 'learner_home' as can_learner_home %}
            {% if can_learner_home %}
            <li><a href="{% url 'learner_home' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_home' %} active{% endif %}"><i class="fa fa-home"></i> Home</a></li>
            {% endif %}
            {% has_role_permission 'learner_attendance' as can_learner_attendance %}
            {% if can_learner_attendance %}
            <li><a href="{% url 'learner_attendance' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_attendance' %} active{% endif %}"><i class="fa fa-clock"></i> Attendance</a></li>
            {% endif %}
            {% has_role_permission 'learner_groups' as can_learner_groups %}
            {% if can_learner_groups %}
            <li><a href="{% url 'learner_groups' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_groups' %} active{% endif %}"><i class="fa fa-users"></i> Groups</a></li>
            {% endif %}
            {% has_role_permission 'learner_project_plans' as can_learner_project_plans %}
            {% if can_learner_project_plans %}
            <li><a href="{% url 'learner_project_plans' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_project_plans' %} active{% endif %}"><i class="fa fa-calendar-alt"></i> Project Plans</a></li>
            {% endif %}
            {% has_role_permission 'poe_submission' as can_poe_submission %}
            {% if can_poe_submission %}
            <li><a href="{% url 'poe_submission' %}" class="nav-link{% if request.resolver_match.url_name == 'poe_submission' %} active{% endif %}"><i class="fa fa-file-upload"></i> Submit POE</a></li>
            {% endif %}
            {% has_role_permission 'learner_assessment_results' as can_learner_assessment_results %}
            {% if can_learner_assessment_results %}
            <li><a href="{% url 'learner_assessment_results' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_assessment_results' %} active{% endif %}"><i class="fa fa-chart-bar"></i> Assessment Results</a></li>
            {% endif %}
            {% has_role_permission 'view_attendance' as can_view_attendance %}
            {% if can_view_attendance %}
            <li><a href="{% url 'view_attendance' %}" class="nav-link{% if request.resolver_match.url_name == 'view_attendance' %} active{% endif %}"><i class="fa fa-calendar-check"></i> View Attendance</a></li>
            {% endif %}
            {% has_role_permission 'view_upcoming_dates' as can_view_upcoming_dates %}
            {% if can_view_upcoming_dates %}
            <li><a href="{% url 'view_upcoming_dates' %}" class="nav-link{% if request.resolver_match.url_name == 'view_upcoming_dates' %} active{% endif %}"><i class="fa fa-calendar"></i> Upcoming Dates</a></li>
            {% endif %}
            {% has_role_permission 'submit_poe' as can_submit_poe %}
            {% if can_submit_poe %}
            <li><a href="{% url 'submit_poe' %}" class="nav-link{% if request.resolver_match.url_name == 'submit_poe' %} active{% endif %}"><i class="fa fa-file-upload"></i> Submit POE (Portal)</a></li>
            {% endif %}
            {% has_role_permission 'learner_portal' as can_learner_portal %}
            {% if can_learner_portal %}
            <li><a href="{% url 'learner_portal' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_portal' %} active{% endif %}"><i class="fa fa-portal"></i> Learner Portal</a></li>
            {% endif %}
            {% has_role_permission 'sit_summative_exam' as can_sit_summative_exam %}
            {% if can_sit_summative_exam %}
            <li><a href="{% url 'sit_summative_exam' %}" class="nav-link{% if request.resolver_match.url_name == 'sit_summative_exam' %} active{% endif %}"><i class="fa fa-file-alt"></i> Summative Exam</a></li>
            {% endif %}
            <li>
              <a href="{% url 'lif_form' %}?learner_id={{ request.user.learner_profile.id }}" class="nav-link{% if request.resolver_match.url_name == 'lif_form' %} active{% endif %}">
                <i class="fa fa-id-card"></i> Learner Information Form (LIF)
              </a>
            </li>
          </ul>
        </div>
      {% else %}
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#dashboardMenu" aria-expanded="true">
            <i class="fa fa-gauge"></i> <span>Dashboards</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right fa-rotate-90"></span>
          </button>
          <ul class="sidebar-collapse-list show" id="dashboardMenu">
            {% has_role_permission 'sla_dashboard' as can_sla_dashboard %}
            {% if can_sla_dashboard %}
            <li><a href="{% url 'sla_dashboard' %}" class="nav-link{% if request.resolver_match.url_name == 'sla_dashboard' %} active{% endif %}"><i class="fa fa-tachometer-alt"></i> SLA Dashboard</a></li>
            {% endif %}
            {% has_role_permission 'finance_dashboard' as can_finance_dashboard %}
            {% if can_finance_dashboard %}
            <li><a href="{% url 'finance_dashboard' %}" class="nav-link{% if request.resolver_match.url_name == 'finance_dashboard' %} active{% endif %}"><i class="fa fa-chart-line"></i> Finance Dashboard</a></li>
            {% endif %}
            {% has_role_permission 'admin_poe_dashboard' as can_admin_poe_dashboard %}
            {% if can_admin_poe_dashboard %}
            <li><a href="{% url 'admin_poe_dashboard' %}" class="nav-link{% if request.resolver_match.url_name == 'admin_poe_dashboard' %} active{% endif %}"><i class="fa fa-tasks"></i> POE Dashboard</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#slaMenu" aria-expanded="false">
            <i class="fa fa-file-contract"></i> <span>SLA Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="slaMenu">
            {% has_role_permission 'add_sla_wizard' as can_add_sla_wizard %}
            {% if can_add_sla_wizard %}
            <li><a href="{% url 'add_sla_wizard' %}" class="nav-link{% if request.resolver_match.url_name == 'add_sla_wizard' %} active{% endif %}"><i class="fa fa-plus"></i> Add SLA</a></li>
            {% endif %}
            {% has_role_permission 'sla_detail' as can_sla_detail %}
            {% if can_sla_detail %}
            <li><a href="{% url 'sla_detail' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'sla_detail' %} active{% endif %}"><i class="fa fa-info-circle"></i> SLA Details</a></li>
            {% endif %}
            {% has_role_permission 'add_sla_qualifications' as can_add_sla_qualifications %}
            {% if can_add_sla_qualifications %}
            <li><a href="{% url 'add_sla_qualifications' sla_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'add_sla_qualifications' %} active{% endif %}"><i class="fa fa-book"></i> SLA Qualifications</a></li>
            {% endif %}
            {% has_role_permission 'add_sla_billing' as can_add_sla_billing %}
            {% if can_add_sla_billing %}
            <li><a href="{% url 'add_sla_billing' sla_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'add_sla_billing' %} active{% endif %}"><i class="fa fa-credit-card"></i> SLA Billing</a></li>
            {% endif %}
            {% has_role_permission 'add_sla_learners' as can_add_sla_learners %}
            {% if can_add_sla_learners %}
            <li><a href="{% url 'add_sla_learners' sla_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'add_sla_learners' %} active{% endif %}"><i class="fa fa-users"></i> SLA Learners</a></li>
            {% endif %}
            {% has_role_permission 'add_learner_qualification' as can_add_learner_qualification %}
            {% if can_add_learner_qualification %}
            <li><a href="{% url 'add_learner_qualification' sla_id=1 qual_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'add_learner_qualification' %} active{% endif %}"><i class="fa fa-user-plus"></i> Add Learner Qualification</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#poeMenu" aria-expanded="false">
            <i class="fa fa-folder"></i> <span>POE Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="poeMenu">
            {% has_role_permission 'poe_template_list' as can_poe_template_list %}
            {% if can_poe_template_list %}
            <li><a href="{% url 'poe_template_list' %}" class="nav-link{% if request.resolver_match.url_name == 'poe_template_list' %} active{% endif %}"><i class="fa fa-file-alt"></i> POE Templates</a></li>
            {% endif %}
            {% has_role_permission 'poe_template_add' as can_poe_template_add %}
            {% if can_poe_template_add %}
            <li><a href="{% url 'poe_template_add' %}" class="nav-link{% if request.resolver_match.url_name == 'poe_template_add' %} active{% endif %}"><i class="fa fa-plus"></i> Add POE Template</a></li>
            {% endif %}
            {% has_role_permission 'poe_list' as can_poe_list %}
            {% if can_poe_list %}
            <li><a href="{% url 'poe_list' %}" class="nav-link{% if request.resolver_match.url_name == 'poe_list' %} active{% endif %}"><i class="fa fa-list"></i> POE List</a></li>
            {% endif %}
            {% has_role_permission 'poe_annextures' as can_poe_annextures %}
            {% if can_poe_annextures %}
            <li><a href="{% url 'poe_annextures' template_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'poe_annextures' %} active{% endif %}"><i class="fa fa-paperclip"></i> POE Annexures</a></li>
            {% endif %}
            {% has_role_permission 'assess_poe' as can_assess_poe %}
            {% if can_assess_poe %}
            <li><a href="{% url 'assess_poe' poe_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'assess_poe' %} active{% endif %}"><i class="fa fa-check"></i> Assess POE</a></li>
            {% endif %}
            {% has_role_permission 'facilitator_poe_list' as can_facilitator_poe_list %}
            {% if can_facilitator_poe_list %}
            <li><a href="{% url 'facilitator_poe_list' %}" class="nav-link{% if request.resolver_match.url_name == 'facilitator_poe_list' %} active{% endif %}"><i class="fa fa-list"></i> Facilitator POE List</a></li>
            {% endif %}
            {% has_role_permission 'facilitator_poe_feedback' as can_facilitator_poe_feedback %}
            {% if can_facilitator_poe_feedback %}
            <li><a href="{% url 'facilitator_poe_feedback' poe_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'facilitator_poe_feedback' %} active{% endif %}"><i class="fa fa-comment"></i> POE Feedback</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#adobeFormMenu" aria-expanded="false">
            <i class="fa fa-file-pdf"></i> <span>Adobe Forms</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="adobeFormMenu">
            {% has_role_permission 'adobe_form_list' as can_adobe_form_list %}
            {% if can_adobe_form_list %}
            <li><a href="{% url 'adobe_form_list' %}" class="nav-link{% if request.resolver_match.url_name == 'adobe_form_list' %} active{% endif %}"><i class="fa fa-list"></i> Adobe Form List</a></li>
            {% endif %}
            {% has_role_permission 'adobe_form_upload' as can_adobe_form_upload %}
            {% if can_adobe_form_upload %}
            <li><a href="{% url 'adobe_form_upload' %}" class="nav-link{% if request.resolver_match.url_name == 'adobe_form_upload' %} active{% endif %}"><i class="fa fa-upload"></i> Upload Adobe Form</a></li>
            {% endif %}
            {% has_role_permission 'adobe_form_download' as can_adobe_form_download %}
            {% if can_adobe_form_download %}
            <li><a href="{% url 'adobe_form_download' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'adobe_form_download' %} active{% endif %}"><i class="fa fa-download"></i> Download Adobe Form</a></li>
            {% endif %}
            {% has_role_permission 'adobe_form_submit' as can_adobe_form_submit %}
            {% if can_adobe_form_submit %}
            <li><a href="{% url 'adobe_form_submit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'adobe_form_submit' %} active{% endif %}"><i class="fa fa-check"></i> Submit Adobe Form</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#lifMenu" aria-expanded="false">
            <i class="fa fa-id-card"></i> <span>LIF Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="lifMenu">
            {% has_role_permission 'lif_form' as can_lif_form %}
            {% if can_lif_form %}
            <li><a href="{% url 'lif_form' %}" class="nav-link{% if request.resolver_match.url_name == 'lif_form' %} active{% endif %}"><i class="fa fa-id-card"></i> LIF Form</a></li>
            {% endif %}
            {% has_role_permission 'lif_update' as can_lif_update %}
            {% if can_lif_update %}
            <li><a href="{% url 'lif_update' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'lif_update' %} active{% endif %}"><i class="fa fa-edit"></i> Update LIF</a></li>
            {% endif %}
            {% has_role_permission 'lif_delete' as can_lif_delete %}
            {% if can_lif_delete %}
            <li><a href="{% url 'lif_delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'lif_delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete LIF</a></li>
            {% endif %}
            {% has_role_permission 'upload_lif_template' as can_upload_lif_template %}
            {% if can_upload_lif_template %}
            <li><a href="{% url 'upload_lif_template' %}" class="nav-link{% if request.resolver_match.url_name == 'upload_lif_template' %} active{% endif %}"><i class="fa fa-upload"></i> Upload LIF Template</a></li>
            {% endif %}
            {% has_role_permission 'map_lif_template_fields' as can_map_lif_template_fields %}
            {% if can_map_lif_template_fields %}
            <li><a href="{% url 'map_lif_template_fields' template_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'map_lif_template_fields' %} active{% endif %}"><i class="fa fa-link"></i> Map LIF Template Fields</a></li>
            {% endif %}
            {% has_role_permission 'lif_template_list' as can_lif_template_list %}
            {% if can_lif_template_list %}
            <li><a href="{% url 'lif_template_list' %}" class="nav-link{% if request.resolver_match.url_name == 'lif_template_list' %} active{% endif %}"><i class="fa fa-list"></i> LIF Template List</a></li>
            {% endif %}
            {% has_role_permission 'lif_template_delete' as can_lif_template_delete %}
            {% if can_lif_template_delete %}
            <li><a href="{% url 'lif_template_delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'lif_template_delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete LIF Template</a></li>
            {% endif %}
            {% has_role_permission 'generate_lif_word' as can_generate_lif_word %}
            {% if can_generate_lif_word %}
            <li><a href="{% url 'generate_lif_word' %}" class="nav-link{% if request.resolver_match.url_name == 'generate_lif_word' %} active{% endif %}"><i class="fa fa-file-word"></i> Generate LIF Word</a></li>
            {% endif %}
            {% has_role_permission 'generate_bulk_lif_zip' as can_generate_bulk_lif_zip %}
            {% if can_generate_bulk_lif_zip %}
            <li><a href="{% url 'generate_bulk_lif_zip' %}" class="nav-link{% if request.resolver_match.url_name == 'generate_bulk_lif_zip' %} active{% endif %}"><i class="fa fa-file-archive"></i> Generate Bulk LIF ZIP</a></li>
            {% endif %}
            {% has_role_permission 'cognito_lif_entries' as can_cognito_lif_entries %}
            {% if can_cognito_lif_entries %}
            <li><a href="{% url 'cognito_lif_entries' %}" class="nav-link{% if request.resolver_match.url_name == 'cognito_lif_entries' %} active{% endif %}"><i class="fa fa-database"></i> Cognito LIF Entries</a></li>
            {% endif %}
            {% has_role_permission 'export_cognito_to_lif' as can_export_cognito_to_lif %}
            {% if can_export_cognito_to_lif %}
            <li><a href="{% url 'export_cognito_to_lif' %}" class="nav-link{% if request.resolver_match.url_name == 'export_cognito_to_lif' %} active{% endif %}"><i class="fa fa-file-export"></i> Export Cognito to LIF</a></li>
            {% endif %}
            {% has_role_permission 'lif_list_json' as can_lif_list_json %}
            {% if can_lif_list_json %}
            <li><a href="{% url 'lif_list_json' %}" class="nav-link{% if request.resolver_match.url_name == 'lif_list_json' %} active{% endif %}"><i class="fa fa-code"></i> LIF List JSON</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#projectMenu" aria-expanded="false">
            <i class="fa fa-project-diagram"></i> <span>Project Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="projectMenu">
            {% has_role_permission 'projectplan_list' as can_projectplan_list %}
            {% if can_projectplan_list %}
            <li><a href="{% url 'projectplan_list' %}" class="nav-link{% if request.resolver_match.url_name == 'projectplan_list' %} active{% endif %}"><i class="fa fa-calendar"></i> Project Plans</a></li>
            {% endif %}
            {% has_role_permission 'projectplan_add' as can_projectplan_add %}
            {% if can_projectplan_add %}
            <li><a href="{% url 'projectplan_add' %}" class="nav-link{% if request.resolver_match.url_name == 'projectplan_add' %} active{% endif %}"><i class="fa fa-plus"></i> Add Project Plan</a></li>
            {% endif %}
            {% has_role_permission 'projectplan_edit' as can_projectplan_edit %}
            {% if can_projectplan_edit %}
            <li><a href="{% url 'projectplan_edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'projectplan_edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Project Plan</a></li>
            {% endif %}
            {% has_role_permission 'projectplan_delete' as can_projectplan_delete %}
            {% if can_projectplan_delete %}
            <li><a href="{% url 'projectplan_delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'projectplan_delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Project Plan</a></li>
            {% endif %}
            {% has_role_permission 'projectplan_detail' as can_projectplan_detail %}
            {% if can_projectplan_detail %}
            <li><a href="{% url 'projectplan_detail' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'projectplan_detail' %} active{% endif %}"><i class="fa fa-info-circle"></i> Project Plan Details</a></li>
            {% endif %}
            {% has_role_permission 'external_project_list' as can_external_project_list %}
            {% if can_external_project_list %}
            <li><a href="{% url 'external_project_list' %}" class="nav-link{% if request.resolver_match.url_name == 'external_project_list' %} active{% endif %}"><i class="fa fa-globe"></i> External Projects</a></li>
            {% endif %}
            {% has_role_permission 'upload_project_plan_excel' as can_upload_project_plan_excel %}
            {% if can_upload_project_plan_excel %}
            <li><a href="{% url 'upload_project_plan_excel' %}" class="nav-link"><i class="fa fa-file-excel"></i> Upload Project Plans (Excel)</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#sessionMenu" aria-expanded="false">
            <i class="fa fa-clock"></i> <span>Session Dates</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="sessionMenu">
            {% has_role_permission 'sessiondate_list' as can_sessiondate_list %}
            {% if can_sessiondate_list %}
            <li><a href="{% url 'sessiondate_list' %}" class="nav-link{% if request.resolver_match.url_name == 'sessiondate_list' %} active{% endif %}"><i class="fa fa-clock"></i> Session Dates</a></li>
            {% endif %}
            {% has_role_permission 'sessiondate_add' as can_sessiondate_add %}
            {% if can_sessiondate_add %}
            <li><a href="{% url 'sessiondate_add' %}" class="nav-link{% if request.resolver_match.url_name == 'sessiondate_add' %} active{% endif %}"><i class="fa fa-plus"></i> Add Session Date</a></li>
            {% endif %}
            {% has_role_permission 'sessiondate_edit' as can_sessiondate_edit %}
            {% if can_sessiondate_edit %}
            <li><a href="{% url 'sessiondate_edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'sessiondate_edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Session Date</a></li>
            {% endif %}
            {% has_role_permission 'sessiondate_delete' as can_sessiondate_delete %}
            {% if can_sessiondate_delete %}
            <li><a href="{% url 'sessiondate_delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'sessiondate_delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Session Date</a></li>
            {% endif %}
            {% has_role_permission 'upload_session_date_excel' as can_upload_session_date_excel %}
            {% if can_upload_session_date_excel %}
            <li><a href="{% url 'upload_session_date_excel' %}" class="nav-link"><i class="fa fa-file-excel"></i> Upload Session Dates (Excel)</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#venueMenu" aria-expanded="false">
            <i class="fa fa-building"></i> <span>Venues</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="venueMenu">
            {% has_role_permission 'venue_list' as can_venue_list %}
            {% if can_venue_list %}
            <li><a href="{% url 'venue_list' %}" class="nav-link{% if request.resolver_match.url_name == 'venue_list' %} active{% endif %}"><i class="fa fa-building"></i> Venues</a></li>
            {% endif %}
            {% has_role_permission 'venue_add' as can_venue_add %}
            {% if can_venue_add %}
            <li><a href="{% url 'venue_add' %}" class="nav-link"><i class="fa fa-plus"></i> Add Venue</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#venueBookingMenu" aria-expanded="false">
            <i class="fa fa-calendar-check"></i> <span>Venue Bookings</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="venueBookingMenu">
            {% has_role_permission 'venuebooking_list' as can_venuebooking_list %}
            {% if can_venuebooking_list %}
            <li><a href="{% url 'venuebooking_list' %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_list' %} active{% endif %}"><i class="fa fa-calendar-check"></i> Venue Bookings</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_add' as can_venuebooking_add %}
            {% if can_venuebooking_add %}
            <li><a href="{% url 'venuebooking_add' %}" class="nav-link"><i class="fa fa-plus"></i> Add Venue Booking</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_edit' as can_venuebooking_edit %}
            {% if can_venuebooking_edit %}
            <li><a href="{% url 'venuebooking_edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Venue Booking</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_delete' as can_venuebooking_delete %}
            {% if can_venuebooking_delete %}
            <li><a href="{% url 'venuebooking_delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Venue Booking</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_modal_form' as can_venuebooking_modal_form %}
            {% if can_venuebooking_modal_form %}
            <li><a href="{% url 'venuebooking_modal_form' %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_modal_form' %} active{% endif %}"><i class="fa fa-window-restore"></i> Venue Booking Modal</a></li>
            {% endif %}
            {% has_role_permission 'venue_availability_api' as can_venue_availability_api %}
            {% if can_venue_availability_api %}
            <li><a href="{% url 'venue_availability_api' %}" class="nav-link{% if request.resolver_match.url_name == 'venue_availability_api' %} active{% endif %}"><i class="fa fa-calendar"></i> Venue Availability API</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_switch' as can_venuebooking_switch %}
            {% if can_venuebooking_switch %}
            <li><a href="{% url 'venuebooking_switch' %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_switch' %} active{% endif %}"><i class="fa fa-exchange-alt"></i> Venue Booking Switch</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_events_api' as can_venuebooking_events_api %}
            {% if can_venuebooking_events_api %}
            <li><a href="{% url 'venuebooking_events_api' %}" class="nav-link"><i class="fa fa-calendar"></i> Venue Booking Events API</a></li>
            {% endif %}
            {% has_role_permission 'venuebooking_calendar' as can_venuebooking_calendar %}
            {% if can_venuebooking_calendar %}
            <li><a href="{% url 'venuebooking_calendar' %}" class="nav-link{% if request.resolver_match.url_name == 'venuebooking_calendar' %} active{% endif %}"><i class="fa fa-calendar-days"></i> Venue Calendar</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#servicesMenu" aria-expanded="false">
            <i class="fa fa-cogs"></i> <span>Services & Modules</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="servicesMenu">
            {% has_role_permission 'service-list' as can_service_list %}
            {% if can_service_list %}
            <li><a href="{% url 'service-list' %}" class="nav-link{% if request.resolver_match.url_name == 'service-list' %} active{% endif %}"><i class="fa fa-list"></i> Services</a></li>
            {% endif %}
            {% has_role_permission 'service-add' as can_service_add %}
            {% if can_service_add %}
            <li><a href="{% url 'service-add' %}" class="nav-link"><i class="fa fa-plus"></i> Add Service</a></li>
            {% endif %}
            {% has_role_permission 'service-edit' as can_service_edit %}
            {% if can_service_edit %}
            <li><a href="{% url 'service-edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'service-edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Service</a></li>
            {% endif %}
            {% has_role_permission 'service-delete' as can_service_delete %}
            {% if can_service_delete %}
            <li><a href="{% url 'service-delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'service-delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Service</a></li>
            {% endif %}
            {% has_role_permission 'module-list' as can_module_list %}
            {% if can_module_list %}
            <li><a href="{% url 'module-list' %}" class="nav-link{% if request.resolver_match.url_name == 'module-list' %} active{% endif %}"><i class="fa fa-book"></i> Modules</a></li>
            {% endif %}
            {% has_role_permission 'module-add' as can_module_add %}
            {% if can_module_add %}
            <li><a href="{% url 'module-add' %}" class="nav-link"><i class="fa fa-plus"></i> Add Module</a></li>
            {% endif %}
            {% has_role_permission 'module-edit' as can_module_edit %}
            {% if can_module_edit %}
            <li><a href="{% url 'module-edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'module-edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Module</a></li>
            {% endif %}
            {% has_role_permission 'module-delete' as can_module_delete %}
            {% if can_module_delete %}
            <li><a href="{% url 'module-delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'module-delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Module</a></li>
            {% endif %}
            {% has_role_permission 'service-module-list' as can_service_module_list %}
            {% if can_service_module_list %}
            <li><a href="{% url 'service-module-list' %}" class="nav-link{% if request.resolver_match.url_name == 'service-module-list' %} active{% endif %}"><i class="fa fa-link"></i> Service Modules</a></li>
            {% endif %}
            {% has_role_permission 'service-module-add' as can_service_module_add %}
            {% if can_service_module_add %}
            <li><a href="{% url 'service-module-add' %}" class="nav-link"><i class="fa fa-plus"></i> Add Service Module</a></li>
            {% endif %}
            {% has_role_permission 'service-module-edit' as can_service_module_edit %}
            {% if can_service_module_edit %}
            <li><a href="{% url 'service-module-edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'service-module-edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Service Module</a></li>
            {% endif %}
            {% has_role_permission 'service-module-delete' as can_service_module_delete %}
            {% if can_service_module_delete %}
            <li><a href="{% url 'service-module-delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'service-module-delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Service Module</a></li>
            {% endif %}
            {% has_role_permission 'upload_group_excel' as can_upload_group_excel %}
            {% if can_upload_group_excel %}
            <li><a href="{% url 'upload_group_excel' %}" class="nav-link"><i class="fa fa-file-excel"></i> Upload Groups (Excel)</a></li>
            {% endif %}
            {% has_role_permission 'upload_module_excel' as can_upload_module_excel %}
            {% if can_upload_module_excel %}
            <li><a href="{% url 'upload_module_excel' %}" class="nav-link"><i class="fa fa-file-excel"></i> Upload Modules (Excel)</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#groupMenu" aria-expanded="false">
            <i class="fa fa-users-cog"></i> <span>Group Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="groupMenu">
            {% has_role_permission 'group_management' as can_group_management %}
            {% if can_group_management %}
            <li><a href="{% url 'group_management' %}" class="nav-link{% if request.resolver_match.url_name == 'group_management' %} active{% endif %}"><i class="fa fa-users-cog"></i> Manage Groups</a></li>
            {% endif %}
            {% has_role_permission 'group_create' as can_group_create %}
            {% if can_group_create %}
            <li><a href="{% url 'group_create' %}" class="nav-link"><i class="fa fa-plus"></i> Create Group</a></li>
            {% endif %}
            {% has_role_permission 'group-edit' as can_group_edit %}
            {% if can_group_edit %}
            <li><a href="{% url 'group-edit' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'group-edit' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Group</a></li>
            {% endif %}
            {% has_role_permission 'group-delete' as can_group_delete %}
            {% if can_group_delete %}
            <li><a href="{% url 'group-delete' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'group-delete' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Group</a></li>
            {% endif %}
            {% has_role_permission 'group_detail' as can_group_detail %}
            {% if can_group_detail %}
            <li><a href="{% url 'group_detail' pk=1 %}" class="nav-link{% if request.resolver_match.url_name == 'group_detail' %} active{% endif %}"><i class="fa fa-info-circle"></i> Group Details</a></li>
            {% endif %}
            {% has_role_permission 'generate_bulk_admin_pack_zip' as can_generate_bulk_admin_pack_zip %}
            {% if can_generate_bulk_admin_pack_zip %}
            <li><a href="{% url 'generate_bulk_admin_pack_zip' %}" class="nav-link{% if request.resolver_match.url_name == 'generate_bulk_admin_pack_zip' %} active{% endif %}"><i class="fa fa-file-archive"></i> Generate Admin Pack ZIP</a></li>
            {% endif %}
            {% has_role_permission 'group_qualification_assignment' as can_group_qualification_assignment %}
            {% if can_group_qualification_assignment %}
            <li><a href="{% url 'group_qualification_assignment' %}" class="nav-link{% if request.resolver_match.url_name == 'group_qualification_assignment' %} active{% endif %}"><i class="fa fa-tasks"></i> Group Qualifications</a></li>
            {% endif %}
            {% has_role_permission 'assign_learner_qualification_to_group' as can_assign_learner_qualification_to_group %}
            {% if can_assign_learner_qualification_to_group %}
            <li><a href="{% url 'assign_learner_qualification_to_group' %}" class="nav-link"><i class="fa fa-user-plus"></i> Assign Learner Qualification</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#learnerMenu" aria-expanded="false">
            <i class="fa fa-user-graduate"></i> <span>Learner Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="learnerMenu">
            {% has_role_permission 'learner_list' as can_learner_list %}
            {% if can_learner_list %}
            <li><a href="{% url 'learner_list' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_list' %} active{% endif %}"><i class="fa fa-users"></i> Learner List</a></li>
            {% endif %}
            {% has_role_permission 'learner_details' as can_learner_details %}
            {% if can_learner_details %}
            <li><a href="{% url 'learner_details' learner_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'learner_details' %} active{% endif %}"><i class="fa fa-info-circle"></i> Learner Details</a></li>
            {% endif %}
            {% has_role_permission 'edit_learner' as can_edit_learner %}
            {% if can_edit_learner %}
            <li><a href="{% url 'edit_learner' learner_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'edit_learner' %} active{% endif %}"><i class="fa fa-edit"></i> Edit Learner</a></li>
            {% endif %}
            {% has_role_permission 'delete_learner' as can_delete_learner %}
            {% if can_delete_learner %}
            <li><a href="{% url 'delete_learner' learner_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'delete_learner' %} active{% endif %}"><i class="fa fa-trash"></i> Delete Learner</a></li>
            {% endif %}
            {% has_role_permission 'assign_user_id' as can_assign_user_id %}
            {% if can_assign_user_id %}
            <li><a href="{% url 'assign_user_id' learner_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'assign_user_id' %} active{% endif %}"><i class="fa fa-id-badge"></i> Assign User ID</a></li>
            {% endif %}
            {% has_role_permission 'set_learner_password' as can_set_learner_password %}
            {% if can_set_learner_password %}
            <li><a href="{% url 'set_learner_password' learner_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'set_learner_password' %} active{% endif %}"><i class="fa fa-key"></i> Set Learner Password</a></li>
            {% endif %}
            {% has_role_permission 'learner_schedule_list' as can_learner_schedule_list %}
            {% if can_learner_schedule_list %}
            <li><a href="{% url 'learner_schedule_list' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_schedule_list' %} active{% endif %}"><i class="fa fa-calendar"></i> Learner Schedules</a></li>
            {% endif %}
            {% has_role_permission 'edit_learner_times' as can_edit_learner_times %}
            {% if can_edit_learner_times %}
            <li><a href="{% url 'edit_learner_times' learner_qualification_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'edit_learner_times' %} active{% endif %}"><i class="fa fa-clock"></i> Edit Learner Times</a></li>
            {% endif %}
            {% has_role_permission 'edit_qualification_times' as can_edit_qualification_times %}
            {% if can_edit_qualification_times %}
            <li><a href="{% url 'edit_qualification_times' qual_id=1 %}" class="nav-link{% if request.resolver_match.url_name == 'edit_qualification_times' %} active{% endif %}"><i class="fa fa-clock"></i> Edit Qualification Times</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#billingMenu" aria-expanded="false">
            <i class="fa fa-credit-card"></i> <span>Billing</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="billingMenu">
            {% has_role_permission 'billing_payments' as can_billing_payments %}
            {% if can_billing_payments %}
            <li><a href="{% url 'billing_payments' %}" class="nav-link{% if request.resolver_match.url_name == 'billing_payments' %} active{% endif %}"><i class="fa fa-credit-card"></i> Payments</a></li>
            {% endif %}
            {% has_role_permission 'billing_export' as can_billing_export %}
            {% if can_billing_export %}
            <li><a href="{% url 'billing_export' %}" class="nav-link{% if request.resolver_match.url_name == 'billing_export' %} active{% endif %}"><i class="fa fa-file-export"></i> Export Billing</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#fingerprintMenu" aria-expanded="false">
            <i class="fa fa-fingerprint"></i> <span>Fingerprint</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="fingerprintMenu">
            {% has_role_permission 'upload_fingerprint' as can_upload_fingerprint %}
            {% if can_upload_fingerprint %}
            <li><a href="{% url 'upload_fingerprint' %}" class="nav-link"><i class="fa fa-upload"></i> Upload Fingerprint</a></li>
            {% endif %}
            {% has_role_permission 'fingerprint_list' as can_fingerprint_list %}
            {% if can_fingerprint_list %}
            <li><a href="{% url 'fingerprint_list' %}" class="nav-link"><i class="fa fa-list"></i> Fingerprint List</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#roleMenu" aria-expanded="false">
            <i class="fa fa-user-shield"></i> <span>Role Management</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="roleMenu">
            {% has_role_permission 'role_permission_management' as can_role_permission_management %}
            {% if can_role_permission_management %}
            <li><a href="{% url 'role_permission_management' %}" class="nav-link{% if request.resolver_match.url_name == 'role_permission_management' %} active{% endif %}"><i class="fa fa-key"></i> Role Permissions</a></li>
            {% endif %}
            {% has_role_permission 'learner_role_assignment' as can_learner_role_assignment %}
            {% if can_learner_role_assignment %}
            <li><a href="{% url 'learner_role_assignment' %}" class="nav-link{% if request.resolver_match.url_name == 'learner_role_assignment' %} active{% endif %}"><i class="fa fa-user-tag"></i> Assign Roles</a></li>
            {% endif %}
            {% has_role_permission 'add_learner' as can_add_learner %}
            {% if can_add_learner %}
            <li><a href="{% url 'add_learner' %}" class="nav-link"><i class="fa fa-user-plus"></i> Add Learner</a></li>
            {% endif %}
            {% has_role_permission 'qualification_times_list' as can_qualification_times_list %}
            {% if can_qualification_times_list %}
            <li><a href="{% url 'qualification_times_list' %}" class="nav-link"><i class="fa fa-clock"></i> Qualification Times List</a></li>
            {% endif %}
          </ul>
        </div>
        <div>
          <button class="sidebar-collapse-btn" type="button" data-bs-target="#miscMenu" aria-expanded="false">
            <i class="fa fa-ellipsis-h"></i> <span>Other</span>
            <span class="sidebar-collapse-icon fa fa-chevron-right"></span>
          </button>
          <ul class="sidebar-collapse-list collapse" id="miscMenu">
            {% has_role_permission 'home_redirect' as can_home_redirect %}
            {% if can_home_redirect %}
            <li><a href="{% url 'home_redirect' %}" class="nav-link"><i class="fa fa-arrow-right"></i> Home Redirect</a></li>
            {% endif %}
            {% has_role_permission 'learner-autocomplete' as can_learner_autocomplete %}
            {% if can_learner_autocomplete %}
            <li><a href="{% url 'learner-autocomplete' %}" class="nav-link"><i class="fa fa-search"></i> Learner Autocomplete</a></li>
            {% endif %}
            {% has_role_permission 'facilitator-autocomplete' as can_facilitator_autocomplete %}
            {% if can_facilitator_autocomplete %}
            <li><a href="{% url 'facilitator-autocomplete' %}" class="nav-link"><i class="fa fa-search"></i> Facilitator Autocomplete</a></li>
            {% endif %}
            {% has_role_permission 'get_learner_qualifications' as can_get_learner_qualifications %}
            {% if can_get_learner_qualifications %}
            <li><a href="{% url 'get_learner_qualifications' %}" class="nav-link"><i class="fa fa-search"></i> Get Learner Qualifications</a></li>
            {% endif %}
            {% has_role_permission 'get_sla_qualifications' as can_get_sla_qualifications %}
            {% if can_get_sla_qualifications %}
            <li><a href="{% url 'get_sla_qualifications' %}" class="nav-link"><i class="fa fa-search"></i> Get SLA Qualifications</a></li>
            {% endif %}
          </ul>
        </div>
      {% endif %}
      <div class="mt-auto">
        <div class="p-3 text-center" style="font-weight:600;">
          <i class="fa fa-user"></i>
          {{ request.user.get_full_name|default:request.user.username }}
          <small class="d-block text-muted">{{ current_role }}</small>
        </div>
        <div class="p-3">
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger w-100">
              <i class="fa fa-sign-out-alt"></i> Logout
            </button>
          </form>
        </div>
      </div>
    {% endif %}
  </nav>
  <!-- Role Switcher -->
  {% if available_roles|length > 1 %}
  <div class="role-switcher">
    <div class="dropdown">
      <button class="btn dropdown-toggle" type="button" id="roleSwitchDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fa fa-exchange-alt"></i> Role: {{ current_role|default:"Select Role" }}
      </button>
      <ul class="dropdown-menu" aria-labelledby="roleSwitchDropdown">
        {% if has_learner_role %}
        <li>
          <a class="dropdown-item {% if current_role == 'Learner' %}active{% endif %}" href="{% url 'switch_role' %}?role=learner">
            <i class="fa fa-user-graduate"></i> Learner
          </a>
        </li>
        {% endif %}
        {% for role in admin_roles %}
        <li>
          <a class="dropdown-item {% if current_role == role.role.name %}active{% endif %}" href="{% url 'switch_role' %}?role={{ role.role.name|lower }}">
            <i class="fa fa-user-shield"></i> {{ role.role.name }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
  <!-- Content Wrapper -->
  <div class="content-wrapper">
    {% block content %}{% endblock %}
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script>
    // Sidebar collapse/expand
    document.querySelectorAll('.sidebar-collapse-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var target = document.querySelector(btn.getAttribute('data-bs-target'));
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', !expanded);
        if (target) {
          target.classList.toggle('show');
          target.classList.toggle('collapse');
        }
        var icon = btn.querySelector('.sidebar-collapse-icon');
        if (icon) {
          icon.classList.toggle('fa-rotate-90');
        }
      });
    });
    // Hamburger toggle for sidebar
    const sidebar = document.getElementById('sidebarNav');
    const hamburger = document.getElementById('sidebarHamburger');
    const overlay = document.getElementById('sidebarOverlay');
    function openSidebar() {
      sidebar.classList.add('open');
      sidebar.classList.remove('closed');
      overlay.classList.add('active');
    }
    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebar.classList.add('closed');
      overlay.classList.remove('active');
    }
    hamburger.addEventListener('click', openSidebar);
    overlay.addEventListener('click', closeSidebar);
    // On resize, close sidebar on mobile, open on desktop
    function handleSidebarOnResize() {
      if (window.innerWidth < 992) {
        closeSidebar();
      } else {
        sidebar.classList.remove('closed');
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
      }
    }
    window.addEventListener('resize', handleSidebarOnResize);
    document.addEventListener('DOMContentLoaded', handleSidebarOnResize);
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>